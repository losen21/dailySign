<!--index.wxml-->
<import src='../toast/toast.wxml'/>
<template is="toast" data="{{ ..._toast_ }}"/>
<view class="main index">
  <swiper autoplay="{{autoplay}}" duration="{{duration}}" bindchange="changeIndex" current='{{current}}'>
      <block wx:for="{{history}}" wx:for-index="index" wx:key='index'>
        <swiper-item bindtap='display' data-index='{{index}}' bindtouchmove='handletouchmove'>
          <!-- <canvas canvas-id='sign-{{index}}' id='daily-canvas'> -->
            <view class='daily-sign style1'>
              <view class='inside-content'>
                <view class='date-section'>
                  <view class='icon'></view>
                  <view class='new-date'>{{item.year}}年{{item.month}}月</view>
                  <view class='old-date'>农历{{item.chiMonth}}{{item.chiDay}}</view>
                  <view class='date-num'>{{item.day}}</view>
                  <view class='festival-content' wx:if="{{item.festival}}"> 
                    <view class='line'></view> 
                    <view class='festival'>{{item.festival}}</view>
                    <view class='line'></view> 
                  </view>
                </view>
                <view class='detali-section'>
                  <view class='tiangan'>
                    <text>{{item.gYear}}</text>
                    <text>·</text>
                    <text>{{item.gMonth}}</text>
                    <text>·</text>
                    <text>{{item.gDay}}</text>
                  </view>
                  <view class='yiji'>
                    <view class='yi'>宜</view>
                    <view class='title'>{{item.yi}}</view>
                    <view class='ji'>忌</view>
                    <view class='title'>{{item.ji}}</view>
                  </view>
                </view>
                <view class='desc-section'>
                  <view class='sign-times' wx:if="{{item.rIndex }}">
                    <text>【第</text>
                    <text>{{item.largerIndex}}</text>
                    <text>天】</text>
                  </view>
                  <view class='desc'>{{item.dayText}}</view>
                </view>
              </view>
            </view>
          <!-- </canvas>      -->
        </swiper-item>
      </block>
  </swiper>

  <view wx:if='{{isToday}}'>
    <view class='sign-content'>
      <view class='tip'>{{tiptxt}}</view>
      <view class='sign' bindtap="signOn">{{signtxt}}</view>
    </view>
    <view class='switch-content'>
      <view class='switch-icon'></view>
      <view class='switch-tip'>切换样式</view>
    </view>
  </view>
  <view wx:if='{{!isToday}}'>
    <view class='switch-content back-today' bindtap='backToday'>
      <view class='today-icon'></view>
      <view class='switch-tip'>回到今天</view>
    </view>
  </view>
  <view class='mask' wx:if='{{showPop}}'></view>
  <view class='pop' wx:if='{{showPop}}'>
    <view class='pop-title'>已签到</view>
    <view class='pop-content'>
      <view class='pop-line'></view>
      <view class='pop-day'>{{signdays}}天</view>
      <view class='pop-line'></view>
    </view>
    <view class='pop-btn'>
      <view class='btn left-btn' bindtap='saveSign'>保存日签</view>
      <view class='btn right-btn' bindtap='shareNow'>立马分享</view>
    </view>
    <view class='close-content' bindtap='closePop'>
      <view class='close-icon'></view>
    </view>
  </view>
</view>
